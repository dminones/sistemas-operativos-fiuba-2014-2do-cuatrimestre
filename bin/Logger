#!/bin/bash
######
#params:

#1)filename
#2)where
#3)code
#4)description

######

reduceFileIfNeeded(){
	typeset FILE=$1
	if [ -f $FILE ]; then #se fija si existe el archivo de log
		#size en bytes
		typeset SIZE_LIMIT=100000
		typeset LINES_TO_DELETE='1,250d'
		typeset SIZE=`wc -c < $FILE`
		if [ $SIZE -ge $SIZE_LIMIT ]; then
			sed -i "$LINES_TO_DELETE" "$FILE"
			SIZE=`wc -c < $FILE`
		fi
	fi
}

log(){
	typeset	JOB_PATH="../../../Documents/facultad/sistemasOperativos/tp/"
#	local JOB_PATH=""
	typeset EXTENSION=".log"

	typeset FILE=$1
	typeset FILE_PATH="$JOB_PATH$FILE$EXTENSION"

	reduceFileIfNeeded "$FILE_PATH"

	typeset WHERE=$2
	typeset DATETIME=`date +'%Y/%m/%d %T'`
	typeset CODE=$3
	typeset DESCRIPTION=$4
	typeset MESSAGE="$DATETIME - $USER - $WHERE - $CODE - $DESCRIPTION"
	echo "$MESSAGE" >> "$FILE_PATH"
}

