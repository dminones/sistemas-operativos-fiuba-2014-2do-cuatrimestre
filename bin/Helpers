#!/bin/bash
#. Logger

pushd `dirname $0` > /dev/null
BINDIR=`pwd`
popd > /dev/null

RECEPT="Recept"
FSOLDES="FSoldes"
CDOSSIER="CDossier"


PIDDIR=$BINDIR
LOGDIR=$BINDIR"/"
NOVEDIR=$BINDIR/../novedir
ACEPDIR=$BINDIR/../acepdir
RECHDIR=$BINDIR/../rechdir
MAEDIR=$BINDIR/../maedir

INITLOG=$LOGDIR"ReceptInit.log"

RECEPT_PID_FILE=$PIDDIR"/RECEIPT_PID"
RECEPT_LOG_NAME="Recept.log"
RECEPT_LOG="$LOGDIR$RECEPT_LOG_NAME"

ERROR="[ERR]"

getFileContent() {
	if [ -f $1 ]; then
	  	echo $(<"$1")
	else
		echo 0
	fi
}

getProcessPid(){
	if [ "$(pgrep -f -o $1)" = "" ];then
			echo 0
	else
			pgrep -f -o $1
	fi
}

Log(){
	#log $RECEPT_LOG $RECEPT $ERROR $1
	echo $1" "$RECEPT" "$ERROR >> $RECEPT_LOG
}


# $1 Proceso a iniciar
initProcess(){
	processPid=$(getProcessPid $1)

	if [ $processPid -eq 0 ]; then

			echo -n "Iniciando $1...   "

			if [ -f $INITLOG ]; then
					rm $INITLOG
			fi

			if [ $RECEPT == $1 ]; then
					initBackground $1
			else
					initForeground $1
			fi

			error=$(cat $INITLOG)
			if [ -s $INITLOG ]; then
					Log "No pudo iniciarse $1: "$error
			else
					echo "[OK]"
			fi

	else
		echo "Recept corriendo bajo el no.: "$processPid
	fi
}

initForeground(){
	$BINDIR/$1
}

initBackground(){
	$BINDIR/$1 >$INITLOG 2>&1 < /dev/null &
}
